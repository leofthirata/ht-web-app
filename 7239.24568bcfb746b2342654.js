(self.webpackChunkht_web_app=self.webpackChunkht_web_app||[]).push([[7239],{7239:(e,t,i)=>{"use strict";i.r(t),i.d(t,{HomePageModule:()=>p});var n=i(8583),s=i(3083),r=i(665),o=i(2316),c=i(4762),a=i(5681);const l=[0,29,58,39,116,105,78,83,232,245,210,207,156,129,166,187,205,208,247,234,185,164,131,158,37,56,31,2,81,76,107,118,135,154,189,160,243,238,201,212,111,114,85,72,27,6,33,60,74,87,112,109,62,35,4,25,162,191,152,133,214,203,236,241,19,14,41,52,103,122,93,64,251,230,193,220,143,146,181,168,222,195,228,249,170,183,144,141,54,43,12,17,66,95,120,101,148,137,174,179,224,253,218,199,124,97,70,91,8,21,50,47,89,68,99,126,45,48,23,10,177,172,139,150,197,216,255,226,38,59,28,1,82,79,104,117,206,211,244,233,186,167,128,157,235,246,209,204,159,130,165,184,3,30,57,36,119,106,77,80,161,188,155,134,213,200,239,242,73,84,115,110,61,32,7,26,108,113,86,75,24,5,34,63,132,153,190,163,240,237,202,215,53,40,15,18,65,92,123,102,221,192,231,250,169,180,147,142,248,229,194,223,140,145,182,171,16,13,42,55,100,121,94,67,178,175,136,149,198,219,252,225,90,71,96,125,46,51,20,9,127,98,69,88,11,22,49,44,151,138,173,176,227,254,217,196];var d=i(4218),h=(()=>(function(e){e[e.DONE=0]="DONE",e[e.WIFI_SCAN=1]="WIFI_SCAN",e[e.WIFI_CONN=2]="WIFI_CONN",e[e.FIND_ME=3]="FIND_ME"}(h||(h={})),h))();class m{constructor(e){this.m_mode=e[0],this.m_data=e}parse(){return(0,c.mG)(this,void 0,void 0,function*(){switch(this.m_mode){case h.DONE:return yield this._createDoneResponse();case h.WIFI_SCAN:return yield this._createScanResponse();case h.WIFI_CONN:return yield this._createConnResponse();case h.FIND_ME:console.log("FIND_ME");break;default:console.log("DEFAULT")}})}_createDoneResponse(){return console.log("DONE"),new Promise(e=>{e(0==this.m_data[1]?"ERR_OK":"ERR_FAIL")})}_createScanResponse(){return console.log("WIFI_SCAN"),new Promise(e=>{console.log(this.m_data);const t=this.m_data.subarray(this.m_data.length-1,this.m_data.length),i=this.m_data.subarray(this.m_data.length-2,this.m_data.length-1),n=this.m_data.subarray(this.m_data.length-3,this.m_data.length-2),s=this.m_data.subarray(4,this.m_data.length-4);var r=(new TextDecoder).decode(t);console.log(r);var o=(new TextDecoder).decode(i);console.log(o);var c=(new TextDecoder).decode(n);console.log(c);var a=(new TextDecoder).decode(s);console.log(a);const l={n:this.m_data[2],ap:this.m_data[3],ssid:(new TextDecoder).decode(this.m_data.subarray(4,this.m_data.length-4)),rssi:(new TextDecoder).decode(this.m_data.subarray(this.m_data.length-3,this.m_data.length-2)),auth:(new TextDecoder).decode(this.m_data.subarray(this.m_data.length-2,this.m_data.length-1)),ciph:(new TextDecoder).decode(this.m_data.subarray(this.m_data.length-1,this.m_data.length))};console.log(l),e(l)})}_createConnResponse(){return console.log("WIFI_CONN"),new Promise(e=>{const t={reg:1===this.m_data[2]?"registered":"not registered",ip:this._hex2ip((0,d.fv)(this.m_data.subarray(3,7))),ipmac:(0,d.fv)(this.m_data.subarray(7,13))};console.log(t),e(t.ip)})}checkResponse(e){}_hex2ip(e){var t="";for(let i=0;i<e.length/2;i++)t+=parseInt(e.substring(2*i,2*(i+1)),16)+".";return t.substring(0,t.length-1)}}class _{constructor(e){this.m_header=new Uint8Array([117,165]),this.m_IV=null,this.m_enc=null,this.m_tail=new Uint8Array([165,213]),this.m_value=null,this.m_data=null,this.m_key=new Uint8Array([2,229,150,205,171,45,129,50,10,148,191,214,213,43,175,174]),this.m_crc=null,this.m_cmd=null,this.m_resp=null,this.m_mode=e}_createWifiScanCmd(e){this.m_cmd=new Uint8Array([1,e])}_createWifiConnCmd(e,t){let i=(0,d.eG)("02"+(0,d.dP)(e)+"00"+(0,d.dP)(t)+"00");for(let n=0;n<12;n++)i[i.length]=0;this.m_cmd=i}_createFindMeCmd(){this.m_cmd=new Uint8Array([3,0])}_build(){return(0,c.mG)(this,void 0,void 0,function*(){const e=new Uint8Array(21+this.m_enc.byteLength);let t=0;e[t]=this.m_header[0],t++,e[t]=this.m_header[1],t++,e[t]=this.m_enc.byteLength,t++,e.set(this.m_data,t),t+=this.m_data.byteLength,e[t]=this.m_tail[0],t++,e[t]=this.m_tail[1],this.m_value=e})}setData(e){return(0,c.mG)(this,void 0,void 0,function*(){switch(this.m_mode){case u.SCAN:this._createWifiScanCmd(e.ap);break;case u.CONN:this._createWifiConnCmd(e.ssid,e.pswd);break;case u.FIND_ME:this._createFindMeCmd()}this.m_crc=yield function(e){return new Promise(t=>{let i=255;for(let n=0;n<e.length;n++)i=l[i^e[n]];t(new Uint8Array([255^i]))})}(this.m_cmd);var t=new Uint8Array(this.m_cmd.byteLength+this.m_crc.byteLength);t.set(this.m_cmd),t.set(this.m_crc,this.m_cmd.byteLength);let i=yield(0,a.HI)(t,this.m_key);this.m_IV=i.iv,this.m_enc=new Uint8Array(i.enc),this.m_data=i.package,yield this._build()})}decode(e){return new Promise(t=>(0,c.mG)(this,void 0,void 0,function*(){this.m_IV=e.subarray(3,3+this.m_key.length),this.m_enc=e.subarray(3+this.m_IV.length,e.length-2),this.m_data=e.subarray(3,e.length-2),this.m_value=e;const i=yield(0,a.pe)(this.m_enc,this.m_IV,this.m_key);this.m_crc=i.subarray(i.length-1,i.length),this.m_cmd=i.subarray(0,1),this.m_resp=i.subarray(1,i.length-1);const n=new m(i.subarray(0,i.length-1)).parse();t(n)}))}getPackage(){return this.m_value}}var u=(()=>(function(e){e.SCAN="scan",e.CONN="conn",e.FIND_ME="find_me"}(u||(u={})),u))();class g{constructor(e){this.BUFFER_SIZE=1024,this.m_buffer=new Uint8Array(this.BUFFER_SIZE),this.m_index=0,this.m_mac=e,this.m_name=`${e.substring(e.length-4,e.length-2)}:${e.substring(e.length-2,e.length)}`}find(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){this.m_device=yield navigator.bluetooth.requestDevice({filters:[{name:`Hausenn ONE:${this.m_name}`},{services:[30117]}]}),this.m_device?(console.log("find true"),e(!0)):(console.log("find false"),e(!1))}))}connect(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){this.m_server=yield this.m_device.gatt.connect(),this.m_server?(e(!0),console.log("conn true")):(e(!1),console.log("conn false"))}))}disconnect(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){yield this.m_device.gatt.disconnect(),console.log("disc"),e(!0)}))}getService(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){this.m_service=yield this.m_device.gatt.getPrimaryService("000075a5-0000-1000-8000-00805f9b34fb"),console.log(this.m_service),this.m_service?(console.log("svc true"),e(!0)):(console.log("svc false"),e(!1))}))}getCharacteristics(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){this.m_readCharacteristic=yield this.m_service.getCharacteristic("3b274ac1-e910-4188-95aa-452018d93750"),this.m_writeCharacteristic=yield this.m_service.getCharacteristic("bf6d9667-bd7f-4e33-a608-21520546c82d"),console.log(this.m_readCharacteristic),console.log(this.m_writeCharacteristic),this.m_readCharacteristic&&this.m_writeCharacteristic?(console.log("chr true"),e(!0)):(console.log("chr false"),e(!1))}))}_listen(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){console.log("listening"),(yield this.m_readCharacteristic.startNotifications()).addEventListener("characteristicvaluechanged",this._read.bind(this)),e(!0)}))}_read(e){return(0,c.mG)(this,void 0,void 0,function*(){const t=new Uint8Array(e.target.value.buffer);yield this._parsePacket(t)})}_parsePacket(e){return(0,c.mG)(this,void 0,void 0,function*(){if(this.m_buffer.set(e,this.m_index),this.m_index+=e.length,117==this.m_buffer[0]&&165==this.m_buffer[1]||(this.m_index=0,console.warn("Dropped packet: ["+e.toString()+"]")),165==this.m_buffer[this.m_index-2]&&213==this.m_buffer[this.m_index-1]){console.log("Received packet: ["+this.m_buffer.subarray(0,this.m_index).toString()+"]");const e=this.m_index;this.m_index=0;const t=new _;this.m_rslt=yield t.decode(this.m_buffer.subarray(0,e)),console.log(this.m_rslt)}})}_write(e,t){return new Promise(i=>(0,c.mG)(this,void 0,void 0,function*(){for(let i=0;i<t/16;i++)yield this.m_writeCharacteristic.writeValue(e.slice(16*i,16*(i+1)))}))}scanWifi(e){return new Promise(t=>(0,c.mG)(this,void 0,void 0,function*(){const i=new _(u.SCAN);console.log(i);const n={ap:e,ssid:null,pswd:null};yield i.setData(n),this._write(i.getPackage().buffer,i.getPackage().byteLength),yield this.m_readCharacteristic.readValue(),yield this._listen(),t(!0)}))}connectToWifi(e,t){return new Promise(i=>(0,c.mG)(this,void 0,void 0,function*(){const n=new _(u.CONN);console.log(n);const s={ap:null,ssid:e,pswd:t};yield n.setData(s),this._write(n.getPackage().buffer,n.getPackage().byteLength),yield this.m_readCharacteristic.readValue(),yield this._listen(),i(!0)}))}findMe(){return new Promise(e=>(0,c.mG)(this,void 0,void 0,function*(){const t=new _(u.FIND_ME);console.log(t),yield t.setData(),this._write(t.getPackage().buffer,t.getPackage().byteLength),yield this.m_readCharacteristic.readValue(),yield this._listen(),e(!0)}))}getIp(){return this.m_rslt}}var f=i(639);const v=function(){return["/testing"]},b=[{path:"",component:(()=>{class e{constructor(e){this.nav=e,this.deviceSelected=!1}deviceSelectionOnClick(){return(0,c.mG)(this,void 0,void 0,function*(){this.m_ble=new g("7C9EBDD71678"),this.deviceSelected=!0})}scanWifiOnClick(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.m_ble.find(),yield this.m_ble.connect(),yield this.m_ble.getService(),yield this.m_ble.getCharacteristics(),yield this.m_ble.findMe(),yield this.m_ble.disconnect()})}findMeOnClick(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.m_ble.find(),yield this.m_ble.connect(),yield this.m_ble.getService(),yield this.m_ble.getCharacteristics(),yield this.m_ble.findMe(),yield this.m_ble.disconnect()})}connectToWifiOnClick(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.m_ble.find(),yield this.m_ble.connect(),yield this.m_ble.getService(),yield this.m_ble.getCharacteristics(),yield this.m_ble.connectToWifi("Leo","12079412"),this.pushToNextScreenWithParams("testing",this.m_ble.getIp()),yield this.m_ble.disconnect()})}pushToNextScreenWithParams(e,t){this.nav.navigateForward(e,{state:t})}}return e.\u0275fac=function(t){return new(t||e)(f.Y36(s.SH))},e.\u0275cmp=f.Xpm({type:e,selectors:[["app-home"]],decls:33,vars:5,consts:[[1,"auth-form"],["placeholder","Choose a product"],["value","one"],["value","lumina"],["value","tbd"],["clearInput","","value","PADOTEC","placeholder","Enter access point name (ssid) "],["clearInput","","value","P@d0t3c2021","placeholder","Enter access point password "],["expand","block","color","dark",3,"click"],["expand","block","color","dark",3,"disabled","click"],["expand","block","color","dark",3,"routerLink","disabled","click"]],template:function(e,t){1&e&&(f.TgZ(0,"ion-header"),f.TgZ(1,"ion-toolbar"),f.TgZ(2,"ion-title"),f._uU(3," Hausenn Products Testing "),f.qZA(),f.qZA(),f.qZA(),f.TgZ(4,"ion-content",0),f.TgZ(5,"ion-item"),f.TgZ(6,"ion-label"),f._uU(7," Hausenn Products "),f.qZA(),f.TgZ(8,"ion-select",1),f.TgZ(9,"ion-select-option",2),f._uU(10,"ONE"),f.qZA(),f.TgZ(11,"ion-select-option",3),f._uU(12,"Lumina"),f.qZA(),f.TgZ(13,"ion-select-option",4),f._uU(14,"tbd"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(15,"ion-item"),f.TgZ(16,"ion-label"),f._uU(17,"Wi-Fi Configuration"),f.qZA(),f.qZA(),f.TgZ(18,"ion-item"),f._UZ(19,"ion-input",5),f.qZA(),f.TgZ(20,"ion-item"),f._UZ(21,"ion-input",6),f.qZA(),f.TgZ(22,"ion-grid"),f.TgZ(23,"ion-row"),f.TgZ(24,"ion-col"),f.TgZ(25,"ion-button",7),f.NdJ("click",function(){return t.deviceSelectionOnClick()}),f._uU(26,"SELECT DEVICE"),f.qZA(),f.TgZ(27,"ion-button",8),f.NdJ("click",function(){return t.scanWifiOnClick()}),f._uU(28,"SCAN WIFI"),f.qZA(),f.TgZ(29,"ion-button",8),f.NdJ("click",function(){return t.findMeOnClick()}),f._uU(30,"FIND_ME"),f.qZA(),f.TgZ(31,"ion-button",9),f.NdJ("click",function(){return t.connectToWifiOnClick()}),f._uU(32,"CONNECT TO WIFI"),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()),2&e&&(f.xp6(27),f.Q6J("disabled",!t.deviceSelected),f.xp6(2),f.Q6J("disabled",!t.deviceSelected),f.xp6(2),f.Q6J("routerLink",f.DdM(4,v))("disabled",!t.deviceSelected))},directives:[s.Gu,s.sr,s.wd,s.W2,s.Ie,s.Q$,s.t9,s.QI,s.n0,s.pK,s.j9,s.jY,s.Nd,s.wI,s.YG,s.YI,o.rH],styles:["#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}ion-select[_ngcontent-%COMP%]{color:#545ca7;--placeholder-color:#971e49;--placeholder-opacity:1}"]}),e})()}];let y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[o.Bz.forChild(b)],o.Bz]}),e})(),p=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=f.oAB({type:e}),e.\u0275inj=f.cJS({imports:[[n.ez,r.u5,s.Pc,y]]}),e})()}}]);